<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">
	<resultMap id="memberResultSet" type="Member">
		<id column="USNO" property="usNo"/>
		<result column="PANO" property="paNo"/>
		<result column="EMAIL" property="email"/>
		<result column="USER_PWD" property="userPwd"/>
		<result column="USER_NAME" property="userName"/>
		<result column="PHONE" property="phone"/>
		<result column="POINT" property="point"/>
		<result column="USER_KIND" property="userKind"/>
		<result column="ENROLL_DATE" property="enrollDate"/>
		<result column="STATUS" property="status"/>
		<result column="YELLOW_CARD" property="yellowCard"/>
		<result column="ORIGIN_NAME" property="originName"/>
		<result column="CHANGE_NAME" property="changeName"/>
		<result column="FILE_PATH" property="filePath"/>
	
		<result column="PARTNER_INTRO" property="partnerIntro"/>
		<result column="PA_ENROLL_DATE" property="paEnrollDate"/>
		<result column="ACCOUNT_NAME" property="accountName"/>
		<result column="ACCOUNT_NUM" property="accountNum"/>
		<result column="PRE_MSG" property="preMsg"/>
		<result column="PA_YELLOW_CARD" property="paYellowCard"/>
		<result column="PARTNER_STATUS" property="partnerStatus"/>
	</resultMap>
	
	<insert id="insertMember" parameterType="Member">
		insert into MEMBER
		values(usno.nextval, null, #{email}, #{userPwd}, #{userName}, #{phone}, 0, 1, SYSDATE, 'Y', 0,NULL,'default.jpg',NULL)
	</insert>
	
	<select id="loginMember" resultMap="memberResultSet" parameterType="Member">
		select *
		  from Member
	 left join partner using(pano)
		 where email = #{email}
		   and status = 'Y'
	</select>
	
	<select id="emailCheck" parameterType="string" resultType="_int">
		select count(*)
		  from member
		 where email=#{email}
	</select>
	
	<update id="updatePwd" parameterType="Member">
		update member
		   set user_pwd = #{userPwd}
		 where email = #{email}
	</update>

	<update id="updatePartnerNo" parameterType="Member">
		update member
		   set paNo = pano.currval,
		   	   user_kind = 2,
		   	   origin_name = #{originName},
		   	   change_name = #{changeName}
		 where usNo = #{usNo}
	</update>	
	<insert id="insertPartner" parameterType="Member">
		insert into partner
		values(pano.nextval,#{partnerIntro},SYSDATE,null,null,null,default,'N')
	</insert>

</mapper>
